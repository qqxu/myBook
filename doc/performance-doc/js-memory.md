### 垃圾回收机制

垃圾回收机制: 找出不再被使用的变量，释放占用的内存。这个过程开销较大，垃圾回收器会固定间隔周期性执行该过程，不同浏览器有各自的差异

> 全局变量在页面销毁之前会一直存在。所以这里提到的垃圾回收机制是针对局部变量的。


**什么时候内存分配**
- 定义变量时
- 函数调用时
- 使用值的过程就是对分配内存的读取与写入操作


垃圾回收的两种方法：
- 引用计数
- 标记清除

**引用计数**
如果值的引用数为0的，表示值不再被用到，就可以被回收，释放内存

意外情况： 
循环引用就会出现问题，test函数执行完后，a、b的引用次数仍然为2，所以占用的空间不会被清理，如果test执行多次，就会不断有空间不被回收，造成内存泄露

```
function test() { 
    var a = {}; 
    var b = {}; 
    a.prop = b; 
    b.prop = a;
}

```

**标记清除**
垃圾回收期会给内存中的所有变量添加标记，然后定期从全局对象找到可达变量，并把可达变量的标记清除，回收仍然有标记的变量
> 大部分浏览器使用这种，区别是如何标记和间隔时间




**内存溢出**
程序运行所需的内存大于可用内存，就出现内存溢出错误

**内存泄露**
内存不可被使用也不能被回收，造成内存泄露

发生场景:
- 全局变量:页面关闭之前，全局变量都会一直存在
    - 手动设置null
- 遗忘的定时器: 浏览器有专门的线程维护定时器，不挂靠页面
    - 清除定时器并设置null
- 闭包: 返回的函数可以访问外部函数的变量
    - 返回的函数 生命周期不要太长
- 遗漏的dom元素:dom元素正常挂载在dom树上，在dom树上被移除时，即可被回收。js中如果有引用，则dom元素的声明周期 就由这两个地方共同决定了